global:
  smtp_smarthost: "smtp.gmail.com:587"
  smtp_from: "phandinhminh48@gmail.com"
  smtp_auth_username: "phandinhminh48@gmail.com"
  smtp_auth_password: "put your app password here"
  smtp_require_tls: true

route:
  receiver: "null"
  group_by: ["alertname", "service"]
  group_wait: 10s
  group_interval: 5m
  repeat_interval: 1h

  routes:
    # Only send critical/error alerts
    - match_re:
        severity: (critical|error)
      receiver: "email-critical"
      group_wait: 10s
      repeat_interval: 1h

inhibit_rules:
  - source_match:
      severity: "critical"
      alertname: "ServiceDown"
    target_match:
      severity: "warning"
    equal: ["service"]

  - source_match:
      severity: "critical"
      burn_rate: "fast"
    target_match:
      severity: "warning"
      burn_rate: "slow"
    equal: ["service", "slo"]

receivers:
  - name: "null"

  - name: "email-critical"
    email_configs:
      - to: "phandinhminh48@gmail.com"
        headers:
          Subject: "ðŸ”¥ [{{ .GroupLabels.severity | toUpper }}] {{ .GroupLabels.service }} - {{ .GroupLabels.alertname }}"
          Priority: "urgent"
        html: |
          <!DOCTYPE html>
          <html>
          <head>
            <style>
              body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 20px; }
              .header { background-color: #dc3545; color: white; padding: 15px 20px; margin: -20px -20px 20px -20px; }
              .alert { background-color: #f8f9fa; padding: 15px; border-left: 4px solid #dc3545; margin: 10px 0; }
              .field { margin: 8px 0; }
              .label { font-weight: bold; color: #495057; }
              .value { color: #212529; }
              pre { background-color: #e9ecef; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 13px; }
            </style>
          </head>
          <body>
            <div class="header">
              <h2 style="margin: 0;">ðŸ”¥ {{ .GroupLabels.severity | toUpper }} Alert</h2>
            </div>
            
            {{ range .Alerts }}
            <div class="alert">
              <div class="field">
                <span class="label">Service:</span>
                <span class="value">{{ .Labels.service }}</span>
              </div>
              
              <div class="field">
                <span class="label">Alert:</span>
                <span class="value">{{ .Labels.alertname }}</span>
              </div>
              
              {{ if .Labels.endpoint }}
              <div class="field">
                <span class="label">Endpoint:</span>
                <span class="value">{{ .Labels.method }} {{ .Labels.endpoint }}</span>
              </div>
              {{ end }}
              
              {{ if .Labels.handler }}
              <div class="field">
                <span class="label">Handler:</span>
                <span class="value">{{ .Labels.handler }}</span>
              </div>
              {{ end }}
              
              {{ if .Labels.grpc_method }}
              <div class="field">
                <span class="label">gRPC Method:</span>
                <span class="value">{{ .Labels.grpc_service }}/{{ .Labels.grpc_method }}</span>
              </div>
              {{ end }}
              
              {{ if .Labels.job }}
              <div class="field">
                <span class="label">Function/Job:</span>
                <span class="value">{{ .Labels.job }}</span>
              </div>
              {{ end }}
              
              {{ if .Annotations.summary }}
              <div class="field">
                <span class="label">Error:</span>
                <span class="value">{{ .Annotations.summary }}</span>
              </div>
              {{ end }}
              
              {{ if .Annotations.description }}
              <div class="field">
                <span class="label">Details:</span>
                <pre>{{ .Annotations.description }}</pre>
              </div>
              {{ end }}
              
              <div class="field">
                <span class="label">Time:</span>
                <span class="value">{{ .StartsAt.Format "2006-01-02 15:04:05" }}</span>
              </div>
            </div>
            {{ end }}
          </body>
          </html>
        send_resolved: false
