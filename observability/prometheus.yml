# Prometheus Configuration for UIT-Go Observability
# Production-ready configuration with proper scrape intervals and alert rules

global:
  scrape_interval: 15s # How often to scrape targets
  evaluation_interval: 15s # How often to evaluate rules
  scrape_timeout: 10s # Timeout for scrape requests

  # External labels for identifying this Prometheus instance
  external_labels:
    cluster: "uit-go-local"
    environment: "development"

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets: ["alertmanager:9093"]
      timeout: 10s
      api_version: v2

# Rule files for alerts
rule_files:
  - "/etc/prometheus/alerts/*.yml"

# Scrape configurations
scrape_configs:
  # Self-monitoring - Prometheus itself
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]
    metrics_path: /metrics

  # Observability stack monitoring
  - job_name: "loki"
    static_configs:
      - targets: ["loki:3100"]
    metrics_path: /metrics

  - job_name: "tempo"
    static_configs:
      - targets: ["tempo:3200"]
    metrics_path: /metrics

  # NOTE: Application services (api-gateway, authentication-service, etc.) 
  # now use OTLP push metrics to Alloy instead of Prometheus scraping.
  # Alloy receives OTLP metrics on port 4317/4318 and forwards to Prometheus
  # via remote write API. This eliminates the need for service discovery
  # and is required for Azure Container Apps deployment.

  # Redis Exporter (if added)
  # - job_name: 'redis'
  #   static_configs:
  #     - targets: ['redis-exporter:9121']

  # PostgreSQL Exporter (if added)
  # - job_name: 'postgres'
  #   static_configs:
  #     - targets: ['postgres-exporter:9187']
